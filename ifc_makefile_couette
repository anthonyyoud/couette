OUTDIR		= ./
OBJECTS		= parameters.o ic_bc.o derivs.o pressure.o magnetic.o \
                  current.o matrices.o io.o couette_mod.o
COMPFLAGS	= -O3 -w95 -tpp7 -xW -ipo -unroll #-parallel
#COMPFLAGS	= -d0 -CA -CB -CS -CU -CV
TYPE            = implicit
LIBS            = -L $(HOME)/lib -lscalapack -lblacsF77init_MPI-LINUX-0 \
                  -lblacs_MPI-LINUX-0 -lblacsCinit_MPI-LINUX-0 -lblas_ref
COMPILER	= mpif77

#-----------------------------------------------------------------------
all:	$(OBJECTS)
	$(COMPILER) $(COMPFLAGS) -i_dynamic -o\
        $(OUTDIR)couette_mod.out \
        $(OBJECTS) $(LIBS)

#-----------------------------------------------------------------------
parameters.o : parameters.f90
	$(COMPILER) $(COMPFLAGS) -c parameters.f90

#-----------------------------------------------------------------------
pddbtrf.o : pddbtrf.f
	$(COMPILER) $(COMPFLAGS) -c pddbtrf.f

#-----------------------------------------------------------------------
pddbtrs.o : pddbtrs.f
	$(COMPILER) $(COMPFLAGS) -c pddbtrs.f

#-----------------------------------------------------------------------
pddbtrsv.o : pddbtrsv.f
	$(COMPILER) $(COMPFLAGS) -c pddbtrsv.f

#-----------------------------------------------------------------------
dtbtrs.o : dtbtrs.f
	$(COMPILER) $(COMPFLAGS) -c dtbtrs.f

#-----------------------------------------------------------------------
dtbsv.o : dtbsv.f
	$(COMPILER) $(COMPFLAGS) -c dtbsv.f

#-----------------------------------------------------------------------
ic_bc.o : ic_bc.f90
	$(COMPILER) $(COMPFLAGS) -c ic_bc.f90

#-----------------------------------------------------------------------
io.o : io.f90
	$(COMPILER) $(COMPFLAGS) -c io.f90

#-----------------------------------------------------------------------
derivs.o : derivs.f90
	$(COMPILER) $(COMPFLAGS) -c derivs.f90

#-----------------------------------------------------------------------
pressure.o : pressure.f90
	$(COMPILER) $(COMPFLAGS) -c io.f90 pressure.f90

#-----------------------------------------------------------------------
magnetic.o : magnetic.f90
	$(COMPILER) $(COMPFLAGS) -c io.f90 magnetic.f90

#-----------------------------------------------------------------------
current.o : current.f90
	$(COMPILER) $(COMPFLAGS) -c derivs.f90 io.f90 current.f90

#-----------------------------------------------------------------------
matrices.o : matrices.f90
	$(COMPILER) $(COMPFLAGS) -c matrices.f90

#-----------------------------------------------------------------------
couette_mod.o : couette_mod_$(TYPE).f90
	$(COMPILER) $(COMPFLAGS) -c -o couette_mod.o \
                                    couette_mod_$(TYPE).f90
#-----------------------------------------------------------------------
clean :
	rm -f *.o *.mod *.d *.out *.pc *.pcl *.il
